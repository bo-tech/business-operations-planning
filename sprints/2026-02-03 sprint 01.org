* Sprint 1: Initial business-operations Structure

Started: 2026-02-03

** Plan

- [X] Assess repository structure and work out how to split the public part out
- [X] Publish ~sphinx-builder~ to GitHub/bo-tech
- [X] Publish ~default-repository~ template to GitHub/bo-tech
- [X] Update ~default-repository~ template (sphinx-builder URL to GitHub)
- [X] Create ~business-operations~ repository using the template
- [X] Extract ADRs from ~b-ops~ docs/decisions/ (modify titles to include ADR ID)
- [X] Assess remaining docs: categorize as ~business-operations~ / ~demo-ops~ / ~b-ops~
- [X] Extract Minisforum hardware configs from infrastructure/nixos/hardware/
  - aim for nixos-hardware, add into fork and use from fork, then submit upstream
  - added into ~nixos-hardware~ directly
- [X] Update machines to verify everything sill works
- [X] Verify hardware modules work when imported from external flake
  - from ~nixos-hardware~
- [X] Extract first NixOS modules to ~business-operations~ and create a base
  profile.
  - nix/flakes.nix, nix/registry.nix, base-packages.nix
  - profiles/base.nix composing them
  - ADR 0017 documents the layering approach
- [X] Use in ~b-ops~ for all machines.
- [X] Move ansible part over
- [X] Prepare environment with all dependencies for the ansible runs
- [X] Extract Ansible roles to ~business-operations~ (Nix-centric integration via devShell)
- [X] Log ADR: Nix-centric dependency management for Ansible roles (ADR-0018)
- [X] Put a ~demo-ops~ repo up and have a test VM in there using the
  ~business-operations~ profile.
- [ ] fix cilium / openebs workarounds in ~demo-ops~
  - could start with a copy of the needed files, then later it can improve when
    the apps have been moved into ~business-operations~.
- [ ] review - check if nixos based testing can be used in demo-ops, compare k0s-nix
- [ ] first test for ~demo-ops~ and/or ~business-operations~
- [ ] review - the key generation and handling in ~demo-ops~ is just hacked in,
  needs a more solid solution.
- [ ] Extract public documentation to ~business-operations~
- [ ] Build and publish documentation
- [ ] ~demo-ops~ and ~b-ops~ should be able to refer back to the documentation
- [ ] Experiment: explore multi-repo approaches for Flux/Kustomize layer
- [ ] Experiment: try out most promising approaches with VolSync templates
- [ ] Experiment: explore Taskfile pattern for cluster tasks (push to internal Gitea)
- [ ] review - Development across repositories would benefit from something like
  a "dev install", flakes don't seem to support this out of the box though.
- [ ] review - Flakes can provide templates, maybe a template could be provided
  to create an instance of the setup?
  - check if templates also support updating like e.g. ~copier~ does

*** Backlog

- [ ] Document known limitations or similar
  - [ ] Need to select and update per app instead of the whole thing
- [ ] Update secrets handling documentation when working on ~demo-ops~
- [ ] Consider submitting hardware modules to nixos-hardware
- [ ] Document WOL/shutdown task pattern for cluster management
- [ ] Document cluster task patterns (push, info, forward-gitea)
- [ ] Remove unused tasks from ~b-ops~ (trigger-backup, k3s-*, bootstrap)
- [ ] Create Renovate configuration for ~business-operations~ (GitHub)

** Focus

Establish business-operations repository with first low-risk extractions to
validate the multi-repo approach.

** Checkpoint

"Can a NixOS configuration import hardware modules from ~business-operations~?"

** Notes

** Learnings and Insights

- Local development: use ~--override-input business-operations path:...~ for testing
- Container images need ~system.installer.channel.enable = false~ to avoid registry
  conflict with profile-base (channel.nix sets nixpkgs registry for offline use)

** Closing Status
