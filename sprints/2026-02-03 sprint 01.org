* Sprint 1: Initial business-operations Structure

Started: 2026-02-03

** Plan

- [X] Assess repository structure and work out how to split the public part out
- [X] Publish ~sphinx-builder~ to GitHub/bo-tech
- [X] Publish ~default-repository~ template to GitHub/bo-tech
- [X] Update ~default-repository~ template (sphinx-builder URL to GitHub)
- [X] Create ~business-operations~ repository using the template
- [X] Extract ADRs from ~b-ops~ docs/decisions/ (modify titles to include ADR ID)
- [X] Assess remaining docs: categorize as ~business-operations~ / ~demo-ops~ / ~b-ops~
- [X] Extract Minisforum hardware configs from infrastructure/nixos/hardware/
  - aim for nixos-hardware, add into fork and use from fork, then submit upstream
  - added into ~nixos-hardware~ directly
- [X] Update machines to verify everything sill works
- [X] Verify hardware modules work when imported from external flake
  - from ~nixos-hardware~
- [X] Extract first NixOS modules to ~business-operations~ and create a base
  profile.
  - nix/flakes.nix, nix/registry.nix, base-packages.nix
  - profiles/base.nix composing them
  - ADR 0017 documents the layering approach
- [X] Use in ~b-ops~ for all machines.
- [X] Move ansible part over
- [X] Prepare environment with all dependencies for the ansible runs
- [X] Extract Ansible roles to ~business-operations~ (Nix-centric integration via devShell)
- [X] Log ADR: Nix-centric dependency management for Ansible roles (ADR-0018)
- [X] Put a ~demo-ops~ repo up and have a test VM in there using the
  ~business-operations~ profile.
- [X] fix cilium / openebs workarounds in ~demo-ops~
  - could start with a copy of the needed files, then later it can improve when
    the apps have been moved into ~business-operations~.
- [X] review - check if nixos based testing can be used in demo-ops, compare k0s-nix
  - Concluded: NixOS VM tests good for module-level, but primary strategy
    is pytest-based end-to-end testing. See context/notes/testing-strategy.md.
    Next sprint focuses on testing.

** Focus

Establish business-operations repository with first low-risk extractions to
validate the multi-repo approach.

** Checkpoint

"Can a NixOS configuration import hardware modules from ~business-operations~?"

** Notes

- Copied Cilium and OpenEBS helm values from ~b-ops~ into ~demo-ops~
  as interim solution. This unblocked ~demo-ops~ without waiting for
  the full app extraction into ~business-operations~. Tracked in
  ~demo-ops~ ADR-0002.

** Learnings and Insights

- Local development: use ~--override-input business-operations path:...~ for testing
- Container images need ~system.installer.channel.enable = false~ to avoid registry
  conflict with profile-base (channel.nix sets nixpkgs registry for offline use)
- The split is more involved than anticipated. Extracting modules is
  straightforward, but verifying that everything still works across
  three repos is error-prone and manual. Some form of automatic
  checking is vital before continuing the extraction work. Testing
  comes as the next step, then splitting continues with confidence.

** Closing Status

Outcome: Success. The multi-repo approach is validated and working.

What works:
- ~business-operations~ exposes NixOS modules and Ansible roles via flake
- All ~b-ops~ machines import from ~business-operations~
- ~demo-ops~ exists with a working single-node k0s configuration
- Ansible consumed via ~nix develop ...#ansible~
- Hardware modules upstreamed to ~nixos-hardware~

What moves forward:
- Remaining open tasks moved to month plan backlog (2026-02-plan.md)
- Testing strategy researched, next sprint focuses on end-to-end testing

Stats:
- Started: 2026-02-03
- Closed: 2026-02-08
- Duration: 6 days
